// Code generated by the gen package. DO NOT EDIT.
// *** WARNING: Do not edit by hand unless you're certain you know what you are doing! ***

package buildkite

import (
	"encoding/json"
	"fmt"
	"strings"

	"github.com/itchyny/json2yaml"
)

type Pipeline struct {
	Agents *Agents        `json:"agents,omitempty"`
	Env    *Env           `json:"env,omitempty"`
	Image  *Image         `json:"image,omitempty"`
	Notify *BuildNotify   `json:"notify,omitempty"`
	Steps  *PipelineSteps `json:"steps,omitempty"`
}

func (p Pipeline) ToJSON() (string, error) {
	rawJSON, err := json.Marshal(p)
	if err != nil {
		return "", err
	}
	return string(rawJSON), nil
}

func (p *Pipeline) AddStep(step pipelineStep) {
	steps := p.Steps
	if steps == nil {
		steps = &[]PipelineStepsItem{}
	}

	newSteps := append(*steps, step.toStepUnion())
	p.Steps = &newSteps
}

func (p *Pipeline) AddAgent(key string, value any) {
	agents := map[string]interface{}{}
	if p.Agents != nil {
		agents = *p.Agents.AgentsObject
	}

	agents[key] = value
	p.Agents = &Agents{
		AgentsObject: &agents,
	}
}

func (p *Pipeline) AddEnvironmentVariable(key string, value any) {
	env := *p.Env
	if p.Env == nil {
		env = map[string]interface{}{}
	}

	env[key] = value
	p.Env = &env
}

func (p *Pipeline) AddNotify(notify BuildNotifyItem) {
	foo := []BuildNotifyItem{notify}
	p.Notify = &foo
}

func (p *Pipeline) ToYAML() (string, error) {
	data, err := p.ToJSON()
	if err != nil {
		return "", err
	}

	var output strings.Builder
	input := strings.NewReader(data)
	if err := json2yaml.Convert(&output, input); err != nil {
		return "", fmt.Errorf("converting JSON to YAML: %v", err)
	}

	return output.String(), nil
}

func NewPipeline() *Pipeline {
	return &Pipeline{}
}

type pipelineStep interface {
	toStepUnion() PipelineStepsItem
}

func (s BlockStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		BlockStep: &s,
	}
}
func (s CommandStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		CommandStep: &s,
	}
}
func (s GroupStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		GroupStep: &s,
	}
}
func (s InputStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		InputStep: &s,
	}
}
func (s NestedBlockStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		NestedBlockStep: &s,
	}
}
func (s NestedCommandStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		NestedCommandStep: &s,
	}
}
func (s NestedInputStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		NestedInputStep: &s,
	}
}
func (s NestedTriggerStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		NestedTriggerStep: &s,
	}
}
func (s NestedWaitStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		NestedWaitStep: &s,
	}
}
func (s StringBlockStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		StringBlockStep: &s,
	}
}
func (s StringInputStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		StringInputStep: &s,
	}
}
func (s StringWaitStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		StringWaitStep: &s,
	}
}
func (s TriggerStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		TriggerStep: &s,
	}
}
func (s WaitStep) toStepUnion() PipelineStepsItem {
	return PipelineStepsItem{
		WaitStep: &s,
	}
}

func Value[T any](val T) *T {
	return &val
}
