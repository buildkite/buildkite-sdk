package gogen

import (
	"fmt"
	"os"

	"github.com/buildkite/buildkite-sdk/internal/gen/utils"
)

type GoFile struct {
	PackageName string
	Name        string
	Contents    string
}

func (g GoFile) Write() error {
	contents := utils.NewCodeBlock(
		"// Code generated by the gen package. DO NOT EDIT.",
		"// *** WARNING: Do not edit by hand unless you're certain you know what you are doing! ***",
		"",
		fmt.Sprintf("package %s", g.PackageName),
		"",
		g.Contents,
	).String()

	err := os.WriteFile(g.Name, []byte(contents), 0644)
	if err != nil {
		return fmt.Errorf("writing file [%s]: %v", g.Name, err)
	}
	return nil
}

func NewGoFile(packageName, name, contents string) GoFile {
	return GoFile{
		PackageName: packageName,
		Name:        name,
		Contents:    contents,
	}
}
